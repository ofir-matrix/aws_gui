<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AWS Labs EC2 Dashboard</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
	<header>
		<h1>AWS Labs EC2 Dashboard</h1>
		<p class="muted">Config: <code>{{ accounts_path }}</code></p>
		<a class="refresh" href="/">Refresh</a>
	</header>

	{% if errors and errors|length > 0 %}
	<div class="alert">
		<strong>Issues:</strong>
		<ul>
			{% for err in errors %}
			<li>{{ err }}</li>
			{% endfor %}
		</ul>
	</div>
	{% endif %}

	{% if messages and messages|length > 0 %}
	<div class="alert success">
		<ul>
			{% for m in messages %}
			<li>{{ m }}</li>
			{% endfor %}
		</ul>
	</div>
	{% endif %}

	{% if labs_to_instances|length == 0 %}
	<p>No EC2 instances found across configured accounts.</p>
	{% else %}
	<p class="summary">
		Labs: <strong>{{ labs_to_instances|length }}</strong>
		<span class="counts">On: <strong>{{ overall.powered_up }}</strong> / Off: <strong>{{ overall.off }}</strong> / Total: <strong>{{ overall.total }}</strong></span>
	</p>

	<div class="labs">
		{% for lab_name, instances in labs_to_instances.items() %}
		<details class="lab">
			<summary>
				<div class="summary-left">
					<span class="lab-name">{{ lab_name }}</span>
					<span class="muted accounts">Account: {{ summary[lab_name].accounts | join(', ') }}</span>
				</div>
				<div class="summary-actions">
					<form class="inline" method="POST" action="{{ url_for('start_lab') }}" onsubmit="return confirm('Start all stopped instances in {{ lab_name }}?');">
						<input type="hidden" name="lab_name" value="{{ lab_name }}">
						<button type="submit" class="btn">Start all</button>
					</form>
					<form class="inline" method="POST" action="{{ url_for('stop_lab') }}" onsubmit="return confirm('Stop all running instances in {{ lab_name }}?');">
						<input type="hidden" name="lab_name" value="{{ lab_name }}">
						<button type="submit" class="btn danger">Stop all</button>
					</form>
				</div>
				<span class="counts">On: <strong>{{ summary[lab_name].powered_up }}</strong> / Total: <strong>{{ summary[lab_name].total }}</strong></span>
			</summary>
			<div class="lab-content">
				<table class="instances">
					<colgroup>
						<col style="width:14%">
						<col style="width:18%">
						<col style="width:20%">
						<col style="width:12%">
						<col style="width:10%">
						<col style="width:8%">
						<col style="width:9%">
						<col style="width:9%">
					</colgroup>
					<thead>
						<tr>
							<th class="sortable" data-type="string">Account</th>
							<th class="sortable" data-type="string">Instance ID</th>
							<th class="sortable" data-type="string">Name</th>
							<th class="sortable" data-type="string">State</th>
							<th class="sortable" data-type="string">Type</th>
							<th class="sortable" data-type="string">AZ</th>
							<th class="sortable" data-type="ip">Private IP</th>
							<th class="sortable" data-type="ip">Public IP</th>
						</tr>
					</thead>
					<tbody>
						{% for i in instances %}
						<tr>
							<td>{{ i.account }}</td>
							<td class="mono">{{ i.instance_id }}</td>
							<td>{{ i.name }}</td>
							<td>
								<span class="state state-{{ i.state }}">{{ i.state }}</span>
							</td>
							<td>{{ i.type }}</td>
							<td>{{ i.az }}</td>
							<td class="mono">{{ i.private_ip }}</td>
							<td class="mono">{{ i.public_ip }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</details>
		{% endfor %}
	</div>
	{% endif %}

	<footer>
		<p class="muted">Generated by AWS GUI Labs Dashboard</p>
	</footer>
	<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
